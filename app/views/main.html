<div class="+fullheight">

    <div class="container-fluid +fullheight">

        <div class="row +fullheight">
            <div class="col-md-3 +fullheight">

                <div>
                    <h2>Select Region</h2>
                    <ui-select
                            theme="bootstrap"
                            ng-model="vm.vis.locations[0]"
                            ng-disabled="disabled"
                            reset-search-input="true"
                            style="width: 100%;"
                            on-select="vm.selectedLocationsChanged($item, $model)"
                            on-remove="vm.selectedLocationsChanged($item, $model)">
                        <ui-select-match placeholder="Select first region">
                            {{ $select.selected.iloc_name }}
                        </ui-select-match>
                        <ui-select-choices repeat="location in vm.locations | propsFilter: {iloc_name: $select.search}"
                                           refresh="vm.refreshLocations($select.search)"
                                           refresh-delay="0">
                            <div ng-bind-html="location.iloc_name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>

                    <div ng-show="vm.vis.locations.length > 0">
                        <h4>Compare with (optional)</h4>
                        <ui-select
                                theme="bootstrap"
                                ng-model="vm.vis.locations[1]"
                                ng-disabled="disabled"
                                reset-search-input="true"
                                style="width: 100%;"
                                on-select="vm.selectedLocationsChanged($item, $model)"
                                on-remove="vm.selectedLocationsChanged($item, $model)">
                            <ui-select-match placeholder="Select second region">
                                {{ $select.selected.iloc_name }}
                            </ui-select-match>
                            <ui-select-choices
                                    repeat="location in vm.locations | propsFilter: {iloc_name: $select.search}"
                                    refresh="vm.refreshLocations($select.search)"
                                    refresh-delay="0">
                                <div ng-bind-html="location.iloc_name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>

                </div>

                <div ng-show="vm.vis.locations.length > 0">
                    <h2>2. Select topics of interest</h2>
                    <ui-select multiple
                               theme="bootstrap"
                               ng-model="vm.vis.topics"
                               ng-disabled="disabled"
                               reset-search-input="true"
                               style="width: 100%;"
                               on-select="vm.selectedTopicsChanged($item, $model)"
                               on-remove="vm.selectedTopicsChanged($item, $model)">
                        <ui-select-match placeholder="Select topics of interest(s)">
                            {{ $item.label }}
                        </ui-select-match>
                        <ui-select-choices repeat="column in vm.columns | propsFilter: {label: $select.search}">
                            <div ng-bind-html="column.label | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>

                    <div>
                        <h2>3. Generate visualization</h2>

                        <h3>Choose topic for bubble</h3>
                        <ui-select theme="bootstrap"
                                   ng-model="vm.vis.bubble.topic"
                                   ng-disabled="disabled"
                                   reset-search-input="true"
                                   style="width: 100%;"
                                   on-select="vm.selectedBubbleTopicChanged($item, $model)">
                            <ui-select-match placeholder="Select topics of interest(s)">
                                {{$select.selected.label }}
                            </ui-select-match>
                            <ui-select-choices repeat="column in vm.vis.topics | propsFilter: {name: $select.search}">
                                <div ng-bind-html="column.label | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>

                        <h3>Choose topic for choropleth</h3>
                        <ui-select theme="bootstrap"
                                   ng-model="vm.vis.choropleth.topic"
                                   ng-disabled="disabled"
                                   reset-search-input="true"
                                   style="width: 100%;"
                                   on-select="vm.selectedRegionTopicChanged($item, $model)">
                            <ui-select-match placeholder="Select topics of interest(s)">
                                {{$select.selected.label }}
                            </ui-select-match>
                            <ui-select-choices repeat="column in vm.vis.topics | propsFilter: {name: $select.search}">
                                <div ng-bind-html="column.label | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>

            <div class="col-md-6 +fullheight" style="position: relative;">
                    <!--ng-class="{'col-sm-9': !vm.isDataSelected(), 'col-md-6': vm.isDataSelected()}">-->
                <cartodb-map top="vm.bubbleLayer" bottom="vm.regionLayer"></cartodb-map>

                <div class="well" style="position: absolute; top: 10px; right: 30px" ng-show="feature">
                    <div ng-repeat="selection in feature">
                        <div class="text-capitalize">
                            <strong>{{ selection.label }}</strong>
                        </div>
                        <div>
                            <em>{{ selection.level_name }}</em> - {{ selection.value }}
                        </div>
                    </div>
                </div>

                <!--<div style="position:relative">

                </div>-->
            </div>

            <div class="col-md-3 +fullheight">
                <p class="text-muted" style="margin-top:20px" ng-hide="vm.isDataSelected()">
                    Select a region and a topic to see data.
                </p>
                <div ng-show="vm.isDataSelected()">
                    <h3>Data</h3>
                    <table class="table table-bordered">
                        <tr ng-repeat="row in vm.tableData">
                            <td ng-repeat="cell in row">
                                {{ cell }}
                            </td>
                        </tr>
                    </table>

                    <!--<h3>Bar Chart</h3>-->
                    <googlechart data="vm.chartData"></googlechart>
                </div>
            </div>
        </div>
    </div>
</div>